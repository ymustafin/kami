# **Дизайн ML системы – Прогнозирование выручки в магазинах**

## **1 Цели и предпосылки**
### **1.1 Обоснованность разработки продукта**
### **Бизнес цель**
Бизнес цель – замена ручной работы  прогнозами модели, которые будут использоваться для:

- составления плана продаж в магазинах на следующие 6 месяцев
- сегментации магазинов на основе продаж для применения определенной стратегии взаимодействия

Побочная бизнес цель при получении прогнозов – uplift продаж в магазинах, получаемый при:

- точной сегментации магазина и применения определённой стратегии
- управления временем торговых представителей (увеличение посещаемости торговым, к примеру)
### **Описание текущего бизнес-процесса**
Компания из отрасли FMSG отгружает свой товар в магазины для последующей продажи.  Рассматриваемые в задаче магазины – точки частных предпринимателей (ларьки, киоски, все несетевые и малые магазины), называемые в компании традиционной торговлей.

Торговые представители компании на основе чек-листа и своего опыта оценивают средние продажи в магазине за полгода. Значения продаж для каждого из 6 месяцев – одинаковы, далее они нормируются на коэффициент сезонности. 

Торговые представители посещают для оценки:

- заведённые в системе магазины раз в полгода
- новые при их открытии

Прогноз торговых представителей необходим для:

- определения плана продаж по точке
- выбора стратегии работы с магазином
- количество времени, уделяемое на обслуживание торговым представителем магазина. Чем больше времени уделяется – тем выше выручка

Задача торгового представителя компании – содействовать и контролировать реализацию товара. Типовые функции торгового:

- контроль наличия и правильности расстановки товара
- установка дополнительного оборудования для товара – подвесы, полки, холодильники
### **Польза от внедрения ML модели**
Внедрение ML модели сократит расходы на оценку выручки, исключат человеческий фактор торговых представителей, увеличит точность определения значимых магазинов, с которыми необходимо взаимодействовать в первую очередь
### **Критерии успеха:**
- модель выдаёт прогнозы с ≥ точностью, чем торговые представители но не ниже 80%

$$MAPE_{модель}≥MAPE_{торг.пред}$$

Некорректный прогноз по отдельному магазину означает неправильное составление плана по взаимодействию с ним, что несёт дополнительные затраты. Необходимо понимание не только картины в целом (как при использовании WAPE), но и по каждому магазину в частности. MAPE в расчётах:

$$MAPE=\frac{1}{N}\displaystyle\sum_{i=1}^{N}|{\frac{\hat{y_{i}}-y_{i}}{y_{i}}}|,$$

$N$ – общее количество заведённых в системе магазинов на момент прогноза

$\hat{y}_{i}$ – истинное значение среднемесячных продаж за 6 месяцев в магазине

$y_{i}$ – предсказанное значение среднемесячных продаж за 6 месяцев в магазине

- MAPE > 80% для магазинов с ежемесячными продажами категории товаров > 100 т.р. в месяц 
- Экономия затрат, руб. – разработка и поддержка модели обходится дешевле потраченного торговыми представителями времени. Затраты на текущий бизнес-процесс (число предоставляет бизнес):

$$COST=(N+n){t}*{w}+S$$

${N}$ – общее количество заведённых в системе магазинов на момент прогноза;

${n}$ – количество новых магазинов, появляющихся за следующие 5 месяцев;

${t}$ – среднее время, затрачиваемое торговым на оценку магазина торговым;

${w}$ – совокупные затраты на торгового (ставка, затраты на транспорт);

${S}$ – стоимость поддержки аналитиков при составлении плана для торговых;

Затраты на внедрение проекта:

$$COST_{pr}=t_{sum}*{w}+P_{geo}+P_{ОФД}$$

$tsum$ – суммарное затраченное время на проект

$w$ – совокупная почасовая ставка команды

$P_{geo}$ – стоимость закупки геоданных

$P_{ОФД}$ – стоимость закупки чековых продаж ОФД

### **1.2 Бизнес требования и ограничения**
**Целевое видение**

- Необходимо делать предсказания продаж на 6 следующих месяцев. Прогнозы получать 2 раза в год до последнего числа месяца: 
  - Апрель
  - Ноябрь

Гранулярность расчёта – отдельный магазин, продажи категории товаров за месяц

- Предсказываются продажи отдельно для каждой категории товаров, всего 6 категорий. 
- Истинные исторические значения продаж имеются во внутренней системе, данные загружаются спустя 2-3 месяца после факта продажи. 
- Прогнозы для всех заведённых во внутренней системе магазинов (~120к) и для новых, заводящихся в течение 6 месяцев между прогнозами – для них прогноз делается отдельно.
- На основе предсказания необходимо отнести точки к разным сегментам, для каждого из которого выработана стратегия взаимодействия с магазином. Сегменты получаются комбинациями:
  - Формата магазина (известен до посещения торговым) – минимаркет, алкомаркет, и т.д.
  - Площадь магазина (оценивается торговым)
  - Продажи категории товара. Торговый выбирает один из числовых диапазонов, который он считает наиболее близким к реальным продажам категории товара.

- Создание дэшборда для визуализации предсказаний модели. Требования к нему нет в данной операции, достаточно прогнозов в Excel. 
- Интеграция результатов во внутренние системы компании. Результаты расчёта заносятся во внутреннюю систему и доступны всем.

**Бизнес-требования и ограничения для пилота**

- Необходимо cделать предсказания продаж на 6 следующих месяцев до конца мая.
- Гранулярность расчёта – отдельный магазин, продажи категории товаров за месяц
- Предсказываются продажи отдельно для 3-х категорий. 
- Прогнозы делаются для всех магазинах в 3-х выбранных регионах. Регионы выбраны с максимальными различиями в:
  - Географическом положении
  - Характере изменения пешеходного трафика в течение года
  - Концентрации конкурентов-сетевых магазинов

**Проведение пилота**

- Тестирование модели и оценка пилота будут проводится на чековых данных, которые закупятся у операторов фискальных данных (ОФД). Предполагается, что эти данные будут иметь такой же вид, что и продажи категорий товаров по магазинам, имеющиеся во внутренней системе.
  Плюс использования чековых данных:
  - Быстрая оценка пилота – чековые данные доступны раньше ~ на 2 месяца, чем продажи во внутренней системе
  - Как следствие, увеличение времени для ролл-аута и доработок модели

Недостатки:

- Увеличение стоимости проекта
- Риск значимого отличия продаж в двух источниках

При невозможности оценки пилота на данных ОФД, будут использованы данные внутренней системы.

- Процесс тестирования модели

Обучение и валидация модели производится на имеющихся исторических данных продаж (из внутренней системы). Тестирование – на чеках ОФД за 1-2 месяца.

На тестовых данных вычисляется MAPE модели и торговых представителей. Вычисляются COSTpr  для выбранных регионов, масштабируется на полный список регионов.

**Критерии успешности пилота**

- $MAPE > MAPE_{торговых} > 80$%
- $COST_{pr} < COST$
### 1.3 Что входит в скоуп итерации, а что нет
- Нет интеграции во внутренние системы
- Нет визуализации результатов в дэшборде
